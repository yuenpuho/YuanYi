<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Mapping extends Base_Controller {

	public function __construct() {
        parent::__construct(0);

        $this->load->model('BankModel', 'bank', true);
        $this->load->model('CompanyModel', 'company', true);
        $this->load->model('MappingModel', 'mapping', true);
    }


	public function mapCompany() {
	    if (isset($_POST['bank']) && !empty($_POST['bank'])) {
	        $data = array();
	        $bid = $_POST['bank'];
	        $cids = array_keys($_POST['companies']);

	        foreach ($cids as $cid) {
                $data[] = array('bid' => $bid, 'cid' => $cid);
            }

            $result = $this->mapping->mappingCompany($data);

	        if (count($result)) {
	            $this->success();
            } else {
	            $this->error();
            }
        }

	    $this->data['title'] = '选择公司';
        $this->data['banks'] = $this->bank->getBanks();
        $this->data['companies'] = $this->company->getCompanies();

        $this->view('bank/map');
    }

    public function mapUser() {
        $this->data['title'] = '设置银行员工';
	    
        $this->view('bank/map');
    }
}
