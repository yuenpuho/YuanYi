layui.define(['layer', 'element'], function(exports){
    var $ = layui.jquery,
        element = layui.element(),
        contentDOM = $('.layui-tab-content');

    /**
     * iframe自适应
     */
    $(window).resize(function () {
        contentDOM.height($(this).height() - 88);

        contentDOM.find('iframe').each(function () {
            $(this).height(contentDOM.outerHeight());
        });
    }).resize();

    /**
     * 收起或展开导航栏
     */
    $('.layui-nav-shrink').click(function () {
        var sideWidth = $('.layui-header').width();

        if (sideWidth === 200) {
            $('.layui-logo').hide();
            $('.layui-body').css({left: '0'});
            $('.layui-header, .layui-side').css({width: '0'});
            $('.layui-nav-shrink').attr('title', '展开').css({left: '0'}).children('span')
                .css({borderRight: 0, borderLeft: '6px solid #a6a5a5'});
        } else {
            $('.layui-logo').show();
            $('.layui-body').css({left: '200px'});
            $('.layui-header, .layui-logo, .layui-side').css({width: '200px'});
            $('.layui-nav-shrink').attr('title', '收起').css({left: '200px'}).children('span')
                .css({borderRight: '6px solid #a6a5a5', borderLeft: 0});
        }
    });

    /**
     * 监测导航点击事件
     */
    $('.layui-nav-child dd span').each(function (index) {
        $(this).on('click', function(){
            // 高亮显示当前导航
            $(this).parent('dd').addClass('layui-this').siblings('dd').removeClass('layui-this');

            // 新增一个Tab项
            element.tabAdd('tab-nav', {
                id: index,
                title: $(this).attr('title'),
                content: "<iframe id='tab-content-" + index + "' src='" + $(this).attr('data-url') + "'></iframe>"
            });

            // 切换到新增的Tab项上
            element.tabChange('tab-nav', index);

            // 设置 iframe 的高度
            $('#tab-content-' + index).height(contentDOM.outerHeight());
        });
    });

    exports('navigation', {}); // 注意，这里是模块输出的核心，模块名必须和use时的模块名一致
});